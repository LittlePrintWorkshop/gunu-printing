<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê±´ìš°í”„ë¦°íŒ… í†µí•© ê²¬ì  ê³„ì‚°ê¸°</title>
  <style>
    :root { --primary: #037a3f; --bg: #f6f8fb; --card: #ffffff; --text: #0f172a; --line: #e2e8f0; --radius: 12px; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: "Pretendard Variable", Pretendard, sans-serif; background: var(--bg); color: var(--text); padding: 30px; font-size: 14px; }
    .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 280px 1fr 320px; gap: 25px; align-items: start; }
    .img-card { border-radius: var(--radius); overflow: hidden; background: #fff; aspect-ratio: 1/1; position: relative; }
    .form-card { background: var(--card); border-radius: var(--radius); padding: 0 25px 25px 25px; border: 1px solid var(--line); }
    .mode-tabs { display: flex; gap: 5px; padding: 15px 0 20px 0; border-bottom: 1px solid var(--line); margin-bottom: 20px; overflow-x: auto; }
    .tab-btn { padding: 8px 16px; background: #f1f5f9; color: #64748b; border: 1px solid #e2e8f0; border-radius: 20px; font-weight: 700; cursor: pointer; white-space: nowrap; transition: 0.2s; }
    .tab-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .section-header { padding-bottom: 15px; margin-bottom: 15px; border-bottom: 2px solid #e2e8f0; margin-top: 20px; }
    .section-title { font-weight: 800; font-size: 16px; border-left: 4px solid var(--primary); padding-left: 12px; }
    label { display: block; font-weight: 700; color: #475569; margin-bottom: 6px; }
    select, input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; background: #f8fafc; height: 42px; outline: none; }
    .qty-control { display: flex; align-items: center; gap: 5px; margin-bottom: 8px; }
    .qty-btn { width: 42px; height: 42px; border: 1px solid #cbd5e1; background: #fff; border-radius: 8px; cursor: pointer; font-weight: 700; }
    .quick-btns { display: flex; gap: 5px; margin-left: 47px; } 
    .quick-btn { padding: 6px 12px; border: 1px solid #cbd5e1; border-radius: 6px; background: #fff; font-size: 11px; cursor: pointer; }
    .row { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
    .row label { margin: 0; min-width: 60px; }
    .col-group { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
    .paper-section-title { font-size: 14px; font-weight: 700; color: #1e293b; border-bottom: 2px solid var(--primary); padding-bottom: 8px; margin-bottom: 15px; }
    .result-panel { position: sticky; top: 30px; background: #1a2332; color: #fff; border-radius: 16px; padding: 25px; }
    .res-header { display: flex; justify-content: space-between; font-weight: 700; margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 15px; }
    .detail-group { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-bottom: 10px; }
    .group-head { font-weight: 700; margin-bottom: 8px; font-size: 12px; }
    .cost-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px; color: #94a3b8; }
    .cost-row span:last-child { color: #e2e8f0; }
    .sub-total-line { border-top: 1px dashed rgba(255,255,255,0.1); margin-top: 6px; padding-top: 6px; color: #fff; font-weight: 700; }
    .final-box { background: rgba(16,185,129,0.1); border-radius: 12px; padding: 20px; text-align: center; margin-top: 20px; border: 1px solid rgba(16,185,129,0.3); }
    .final-price { font-size: 32px; font-weight: 900; color: #34d399; margin: 5px 0; }
    .calc-btn { width: 100%; padding: 16px; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-size: 16px; font-weight: 800; cursor: pointer; margin-top: 20px; }
    .hidden { display: none !important; }
    @media (max-width: 900px) { .container { grid-template-columns: 1fr; } .img-card { display: none; } }
  </style>
</head>
<body>

<div class="container">
  <div class="img-card">
    <svg width="100%" height="100%" viewBox="0 0 400 400" preserveAspectRatio="none">
        <defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1f7ea9"/><stop offset="100%" stop-color="#037a3f"/></linearGradient></defs>
        <rect width="400" height="400" fill="url(#grad)"/>
        <text x="50%" y="45%" fill="rgba(255,255,255,0.2)" font-size="80" font-weight="900" text-anchor="middle">QUOTE</text>
        <text x="50%" y="55%" fill="#fff" font-size="24" font-weight="700" text-anchor="middle" id="imgText">ê²¬ì  ê³„ì‚°ê¸°</text>
    </svg>
  </div>

  <div class="form-card">
    <div class="mode-tabs">
        <button class="tab-btn active" onclick="setMode('book_indigo', this)">ì†ŒëŸ‰ ì±…ì</button>
        <button class="tab-btn" onclick="setMode('book_digital', this)">í‘ë°± ì±…ì</button>
        <button class="tab-btn" onclick="setMode('book_offset', this)">ëŒ€ëŸ‰ ì±…ì</button>
        <button class="tab-btn" onclick="setMode('flyer_small', this)">ì†ŒëŸ‰ ì „ë‹¨</button>
        <button class="tab-btn" onclick="setMode('flyer_large', this)">ëŒ€ëŸ‰ ì „ë‹¨</button>
    </div>

    <div class="section-header"><div class="section-title">ê¸°ë³¸ ì‚¬ì–‘</div></div>
    <div class="row">
        <label>ì‚¬ì´ì¦ˆ</label>
        <select id="ind-size">
            <option value="A4">A4 (210Ã—297)</option>
            <option value="A5">A5 (148Ã—210)</option>
            <option value="B5">B5 (182Ã—257)</option>
        </select>
    </div>
    <div id="area_flyer_opt" class="hidden">
        <div class="row">
            <label>ì¸ì‡„ë©´</label>
            <select id="ind-flyerSide">
                <option value="double">ì–‘ë©´ ì¸ì‡„</option>
                <option value="single">ë‹¨ë©´ ì¸ì‡„</option>
            </select>
        </div>
    </div>
    <div class="row" style="align-items: flex-start;">
        <label style="margin-top:12px;">ìˆ˜ëŸ‰</label>
        <div style="flex:1;">
            <div class="qty-control">
                <button class="qty-btn" onclick="changeQty(-1)">-</button>
                <input type="number" id="ind-qty" value="100" style="text-align:center;">
                <button class="qty-btn" onclick="changeQty(1)">+</button>
            </div>
            <div class="quick-btns">
                <button class="quick-btn" onclick="addQty(1)">+1ë¶€</button>
                <button class="quick-btn" onclick="addQty(10)">+10ë¶€</button>
                <button class="quick-btn" onclick="addQty(100)">+100ë¶€</button>
            </div>
        </div>
    </div>
    <div class="row" id="area_bind_dir">
        <label>ì œë³¸ë°©í–¥</label>
        <select><option>ì„¸ë¡œí˜•ì¢Œì² </option><option>ì„¸ë¡œí˜•ìš°ì² </option><option>ê°€ë¡œí˜•ìƒì² </option></select>
    </div>

    <div class="section-header"><div class="section-title" id="label_sec_paper">ìš©ì§€/ì¸ì‡„</div></div>
    <div class="col-group">
        <div id="area_cover_col">
            <div class="paper-section-title">ğŸ“Œ í‘œì§€</div>
            <label>ìš©ì§€ ìƒì„¸</label>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <select id="ind-coverType" onchange="updateGram('cover')"></select>
                <select id="ind-coverGram"></select>
            </div>
            <label>ì¸ì‡„ ìƒì„¸</label>
            <select id="ind-coverDetail" style="margin-bottom:10px;">
                <option value="color_double">ì–‘ë©´ ì¹¼ë¼</option>
                <option value="mono_double">ì–‘ë©´ í‘ë°±</option>
                <option value="color_single">ë‹¨ë©´ ì¹¼ë¼</option>
                <option value="mono_single">ë‹¨ë©´ í‘ë°±</option>
            </select>
            <label>í˜ì´ì§€</label>
            <select id="ind-coverPages" onchange="checkCoverOptions()" style="margin-bottom:10px;">
                <option value="4">4p (ì–‘ë©´)</option>
                <option value="2">2p (ë‹¨ë©´)</option>
            </select>
            <label>ì½”íŒ… ìƒì„¸</label>
            <select id="ind-coating">
                <option value="none">ì½”íŒ…ì—†ìŒ</option>
                <option value="matt">ë¬´ê´‘ì½”íŒ…</option>
                <option value="gloss">ìœ ê´‘ì½”íŒ…</option>
            </select>
        </div>
        <div id="area_inner_col">
            <div class="paper-section-title" id="label_inner_col">ğŸ“Œ ë‚´ì§€</div>
            <label>ìš©ì§€ ìƒì„¸</label>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <select id="ind-innerType" onchange="updateGram('inner')"></select>
                <select id="ind-innerGram"></select>
            </div>
            <label>ì¸ì‡„ ìƒì„¸</label>
            <select id="ind-innerDetail" style="margin-bottom:10px;">
                <option value="color_double">ì–‘ë©´ ì¹¼ë¼</option>
                <option value="color_single">ë‹¨ë©´ ì¹¼ë¼</option>
                <option value="mono_double">ì–‘ë©´ í‘ë°±</option>
                <option value="mono_single">ë‹¨ë©´ í‘ë°±</option>
            </select>
            <div id="area_inner_pages">
                <label>í˜ì´ì§€ (í‘œì§€ì œì™¸)</label>
                <select id="ind-innerPages" onchange="calculate()"></select>
            </div>
        </div>
    </div>

    <div id="area_binding_sec">
        <div class="section-header"><div class="section-title">í›„ê°€ê³µ</div></div>
        <div class="row">
            <label>ì œë³¸ë°©ì‹</label>
            <select id="ind-bindType" onchange="updatePageList()">
                <option value="perfect">ë¬´ì„  ì œë³¸</option>
                <option value="staple">ì¤‘ì²  ì œë³¸</option>
            </select>
        </div>
    </div>
    
    <div style="margin-top:20px; padding-top:20px; border-top:1px dashed #e2e8f0;">
        <div class="row">
            <label>ë§ˆì§„ìœ¨(%)</label>
            <input type="number" id="ind-margin" value="0">
        </div>
    </div>
    <button class="calc-btn" onclick="calculate()">ê²¬ì  ê³„ì‚°í•˜ê¸°</button>
  </div>

  <div class="result-panel">
    <div class="res-header">
        <span>ê²¬ì  ìƒì„¸ ë‚´ì—­</span>
        <span style="color:#facc15;" id="resMode">ì†ŒëŸ‰ ì±…ì</span>
    </div>

    <div class="detail-group" id="res_group_cover">
        <div class="group-head" style="color:#f472b6;">â–  í‘œì§€ ë¹„ìš©</div>
        <div class="cost-row"><span>ì¢…ì´ë¹„</span><span id="cvPaper">0</span></div>
        <div class="cost-row"><span>ì¸ì‡„ë¹„</span><span id="cvPrint">0</span></div>
        <div class="cost-row"><span>íŒë¹„(ì˜µì…‹)</span><span id="cvPlate">0</span></div>
        <div class="cost-row"><span>ì½”íŒ…ë¹„</span><span id="cvCoat">0</span></div>
        <div class="cost-row sub-total-line"><span>ì†Œê³„</span><span id="cvTotal">0</span></div>
    </div>

    <div class="detail-group">
        <div class="group-head" style="color:#60a5fa;" id="res_title_inner">â–  ë‚´ì§€ ë¹„ìš©</div>
        <div class="cost-row"><span>ì¢…ì´ë¹„</span><span id="inPaper">0</span></div>
        <div class="cost-row"><span>ì¸ì‡„ë¹„</span><span id="inPrint">0</span></div>
        <div class="cost-row"><span>íŒë¹„(ì˜µì…‹)</span><span id="inPlate">0</span></div>
        <div class="cost-row sub-total-line"><span>ì†Œê³„</span><span id="inTotal">0</span></div>
        <div class="cost-row" style="margin-top:5px; font-size:11px; text-align:right;"><span style="width:100%;" id="inMsg"></span></div>
    </div>

    <div class="detail-group" id="res_group_bind">
        <div class="group-head" style="color:#fbbf24;">â–  ì œë³¸ ë¹„ìš©</div>
        <div class="cost-row"><span>ì œë³¸ë¹„</span><span id="bindCost">0</span></div>
        <div class="cost-row" style="margin-top:5px; font-size:11px; text-align:right;"><span style="width:100%;" id="bindMsg"></span></div>
    </div>

    <div class="detail-group">
        <div class="group-head" style="color:#a3e635;">â–  ë°°ì†¡ ë¹„ìš©</div>
        <div class="cost-row"><span>íƒë°°ë¹„</span><span id="shipCost">0</span></div>
        <div class="cost-row" style="margin-top:5px; font-size:11px; text-align:right; color:#a3e635; font-weight:700;"><span style="width:100%;" id="shipMsg"></span></div>
    </div>

    <div class="final-box">
        <div style="font-size:12px; color:#a7f3d0; margin-bottom:5px;">ê³µê¸‰ê°€ (VATë³„ë„) <span id="supplyPrice">0</span>ì›</div>
        <div class="final-price" id="finalPrice">0ì›</div>
        <div style="font-size:12px; color:#6ee7b7;">(ë¶€ê°€ì„¸ 10% í¬í•¨)</div>
        <div style="font-size:13px; color:#fff; margin-top:10px; font-weight:700;" id="perBook">ê¶Œë‹¹ 0ì›</div>
    </div>
  </div>
</div>

<script>
    // ==========================================
    //  ê±´ìš°í”„ë¦°íŒ… í†µí•© ê²¬ì  ë¡œì§ (ìµœì¢…)
    //  * B5/A5ë„ êµ­ì „ì§€ ì‚¬ìš©
    //  * íƒë°° ë°•ìŠ¤ ì¢…ë¥˜(A4/A3) í‘œì‹œ ë° 20kg ì œí•œ
    // ==========================================
    
    const BOX_PRICE = 4000; 
    
    // ë°•ìŠ¤ ìŠ¤í™ (ë‹¨ìœ„: mm, kg) -> ë‘˜ ë‹¤ ìµœëŒ€ 20kg ì œí•œ
    const BOX_A4 = { name: "A4ë°•ìŠ¤", w: 315, l: 220, h: 270, maxKg: 20 };
    const BOX_A3 = { name: "A3ë°•ìŠ¤", w: 450, l: 305, h: 210, maxKg: 20 };

    const THICKNESS_DB = {
        80: 0.09, 100: 0.105, 120: 0.13, 150: 0.16, 
        180: 0.19, 200: 0.21, 250: 0.26, 300: 0.31
    };

    const YEON_PRICE_DB = {
        "ëª¨ì¡°ì§€": { "80": { "4x6": 73060, "kook": 50750 }, "100": { "4x6": 90530, "kook": 62920 }, "120": { "4x6": 108620, "kook": 75460 }, "150": { "4x6": 135780, "kook": 94320 } },
        "ë¯¸ìƒ‰ëª¨ì¡°ì§€": { "80": { "4x6": 75250, "kook": 52270 }, "100": { "4x6": 93280, "kook": 64790 } },
        "í”ŒëŸ¬ìŠ¤ì§€ë°±ìƒ‰": { "80": { "4x6": 75250, "kook": 57270 }, "100": { "4x6": 93240, "kook": 64790 } },
        "í”ŒëŸ¬ìŠ¤ì§€ë¯¸ìƒ‰": { "80": { "4x6": 77510, "kook": 53840 }, "100": { "4x6": 96030, "kook": 66700 } },
        "í•˜ì´í”ŒëŸ¬ìŠ¤ì—°ë¯¸": { "90": { "4x6": 88550, "kook": 61500 } },
        "ì•„íŠ¸ì§€": { "100": { "4x6": 90040, "kook": 62590 }, "120": { "4x6": 108030, "kook": 75040 }, "150": { "4x6": 137400, "kook": 95480 }, "180": { "4x6": 164890, "kook": 114540 }, "200": { "4x6": 183190, "kook": 127270 }, "250": { "4x6": 228980, "kook": 159070 } },
        "ìŠ¤ë…¸ìš°ì§€": { "100": { "4x6": 90040, "kook": 62590 }, "120": { "4x6": 108030, "kook": 75040 }, "150": { "4x6": 137400, "kook": 95480 }, "180": { "4x6": 164890, "kook": 114540 }, "200": { "4x6": 183190, "kook": 127270 }, "250": { "4x6": 228980, "kook": 159070 } },
        "ì•„ë¥´ë–¼(N)": { "105": { "4x6": 171600, "kook": 119200 }, "130": { "4x6": 212400, "kook": 147600 }, "160": { "4x6": 261800, "kook": 181600 }, "190": { "4x6": 310400, "kook": 215600 }, "210": { "4x6": 343200, "kook": 238700 }, "230": { "4x6": 376200, "kook": 261000 } }
    };

    const OFFSET_PRICE_PER_COLOR = 8000; 
    const INDIGO_CLICK = { color: 200, mono: 40 }; 
    const DIGITAL_CLICK = 20;
    let currentMode = 'book_indigo';

    function comma(num) { return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
    function changeQty(delta) {
        const el = document.getElementById('ind-qty');
        let val = parseInt(el.value) || 0;
        val = Math.max(0, val + delta);
        el.value = val;
    }
    function addQty(amount) { changeQty(amount); }

    function getPaperPrice(paperType, gram, size) {
        if (!YEON_PRICE_DB[paperType] || !YEON_PRICE_DB[paperType][gram]) return 0;
        // B5/A5 ëª¨ë‘ êµ­ì „ì§€(kook) ì‚¬ìš©
        const is4x6 = false; 
        const priceObj = YEON_PRICE_DB[paperType][gram];
        return is4x6 ? priceObj["4x6"] : priceObj["kook"];
    }

    function getThicknessByGram(gram) {
        if (THICKNESS_DB[gram]) return THICKNESS_DB[gram];
        return gram * 0.0011; 
    }

    function updatePageList() {
        const bindType = document.getElementById('ind-bindType').value;
        const pageSelect = document.getElementById('ind-innerPages');
        const currentVal = parseInt(pageSelect.value); 
        pageSelect.innerHTML = ""; 

        let minPages = 4, maxPages = 500;
        if (bindType === 'perfect') minPages = 30; 
        else if (bindType === 'staple') maxPages = 48; 

        for (let i = minPages; i <= maxPages; i += 4) {
            let opt = document.createElement('option');
            opt.value = i; opt.innerText = i + "p";
            pageSelect.appendChild(opt);
        }

        if (currentVal && currentVal >= minPages && currentVal <= maxPages && (currentVal - minPages) % 4 === 0) {
            pageSelect.value = currentVal;
        } else {
            let defaultPage = (bindType === 'perfect') ? 64 : 16;
            if (defaultPage < minPages) defaultPage = minPages;
            pageSelect.value = defaultPage;
        }
        calculate(); 
    }

    function setMode(mode, el) {
        currentMode = mode;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');

        const isFlyer = mode.startsWith('flyer');
        if (isFlyer) {
            document.getElementById('area_cover_col').classList.add('hidden');
            document.getElementById('area_bind_dir').classList.add('hidden');
            document.getElementById('area_binding_sec').classList.add('hidden');
            document.getElementById('area_flyer_opt').classList.remove('hidden');
            document.getElementById('area_inner_pages').classList.add('hidden'); 
            document.getElementById('label_sec_paper').innerText = "ìš©ì§€ ë° ì¸ì‡„";
            document.getElementById('label_inner_col').innerText = "ğŸ“Œ ì „ë‹¨ì§€ ì„¤ì •";
            document.getElementById('res_group_cover').classList.add('hidden');
            document.getElementById('res_group_bind').classList.add('hidden');
            document.getElementById('res_title_inner').innerText = "â–  ì „ë‹¨ì§€ ë¹„ìš©";
            document.querySelector('.col-group').style.gridTemplateColumns = "1fr";
            document.getElementById('imgText').innerText = "ì „ë‹¨ì§€ ê²¬ì ";
        } else {
            document.getElementById('area_cover_col').classList.remove('hidden');
            document.getElementById('area_bind_dir').classList.remove('hidden');
            document.getElementById('area_binding_sec').classList.remove('hidden');
            document.getElementById('area_flyer_opt').classList.add('hidden');
            document.getElementById('area_inner_pages').classList.remove('hidden'); 
            document.getElementById('label_sec_paper').innerText = "ìš©ì§€/ì¸ì‡„";
            document.getElementById('label_inner_col').innerText = "ğŸ“Œ ë‚´ì§€";
            document.getElementById('res_group_cover').classList.remove('hidden');
            document.getElementById('res_group_bind').classList.remove('hidden');
            document.getElementById('res_title_inner').innerText = "â–  ë‚´ì§€ ë¹„ìš©";
            document.querySelector('.col-group').style.gridTemplateColumns = "1fr 1fr";
            document.getElementById('imgText').innerText = "ì±…ì ê²¬ì ";
            updatePageList();
        }

        const innerDetail = document.getElementById('ind-innerDetail');
        if(mode.includes('digital')) {
            innerDetail.value = 'mono_double';
            for(let i=0; i<innerDetail.options.length; i++){
                if(innerDetail.options[i].value.includes('color')) innerDetail.options[i].disabled = true;
                else innerDetail.options[i].disabled = false;
            }
        } else {
            for(let i=0; i<innerDetail.options.length; i++) innerDetail.options[i].disabled = false;
        }
        document.getElementById('resMode').innerText = 
            { 'book_indigo': 'ì†ŒëŸ‰ ì±…ì (ì¸ë””ê³ )', 'book_digital': 'ì†ŒëŸ‰ ì±…ì (í‘ë°±)', 'book_offset': 'ëŒ€ëŸ‰ ì±…ì (ì˜µì…‹)',
              'flyer_small': 'ì†ŒëŸ‰ ì „ë‹¨ (ì¸ë””ê³ )', 'flyer_large': 'ëŒ€ëŸ‰ ì „ë‹¨ (ì˜µì…‹)' }[mode];
        
        if (!isFlyer) checkCoverOptions();
    }

    function initPaper() {
        const c = document.getElementById('ind-coverType');
        const i = document.getElementById('ind-innerType');
        for(let k in YEON_PRICE_DB){
            let opt = document.createElement('option'); opt.value=k; opt.innerText=k;
            c.appendChild(opt.cloneNode(true));
            i.appendChild(opt.cloneNode(true));
        }
        updateGram('cover'); updateGram('inner');
    }

    function updateGram(t) {
        const type = document.getElementById('ind-'+t+'Type').value;
        const sel = document.getElementById('ind-'+t+'Gram');
        sel.innerHTML = "";
        if (YEON_PRICE_DB[type]) {
            for(let g in YEON_PRICE_DB[type]){
                let opt = document.createElement('option'); opt.value=g; opt.innerText=g+"g";
                sel.appendChild(opt);
            }
        }
    }

    function checkCoverOptions() {
        const pages = document.getElementById('ind-coverPages').value; 
        const detailSelect = document.getElementById('ind-coverDetail');
        const currentVal = detailSelect.value; 
        for (let i = 0; i < detailSelect.options.length; i++) detailSelect.options[i].disabled = false;
        if (pages === "2") {
            for (let i = 0; i < detailSelect.options.length; i++) if (detailSelect.options[i].value.includes('double')) detailSelect.options[i].disabled = true;
            if (currentVal.includes('double')) detailSelect.value = currentVal.includes('color') ? "color_single" : "mono_single";
        } else {
            for (let i = 0; i < detailSelect.options.length; i++) if (detailSelect.options[i].value.includes('single')) detailSelect.options[i].disabled = true;
            if (currentVal.includes('single')) detailSelect.value = currentVal.includes('color') ? "color_double" : "mono_double";
        }
        calculate(); 
    }

    function calculateShipping(qty, size, pages, cvGram, inGram, isFlyer) {
        let wMM=210, hMM=297; 
        if(size==='A5') { wMM=148; hMM=210; }
        else if(size==='B5') { wMM=182; hMM=257; }
        
        const area = (wMM/1000) * (hMM/1000);
        let singleWeight = 0; 
        let singleThick = 0; 

        if(isFlyer) {
             singleWeight = area * inGram;
             singleThick = getThicknessByGram(inGram);
        } else {
            const inSheets = Math.ceil(pages / 2);
            singleWeight += area * inGram * inSheets;
            singleThick += getThicknessByGram(inGram) * inSheets;

            const cvPages = parseInt(document.getElementById('ind-coverPages').value);
            const cvSheets = Math.ceil(cvPages / 2);
            singleWeight += (area * 2) * cvGram * cvSheets; 
            singleThick += getThicknessByGram(cvGram) * cvSheets; 
        }

        // ë°•ìŠ¤ ì„ ì •: ì „ë‹¨ì€ A3ë°•ìŠ¤, ì±…ìëŠ” A4ë°•ìŠ¤
        let box = isFlyer ? BOX_A3 : BOX_A4;
        let booksPerLayer = 1;
        if(!isFlyer && size==='A5') booksPerLayer = 2; 
        if(isFlyer && size==='A4') booksPerLayer = 2;
        if(isFlyer && size==='A5') booksPerLayer = 4;

        const booksPerStack = Math.floor(box.h / singleThick);
        let maxBooksByVol = booksPerStack * booksPerLayer;
        if(maxBooksByVol < 1) maxBooksByVol = 1; 

        const maxBooksByWeight = Math.floor((box.maxKg * 1000) / singleWeight);
        const countPerBox = Math.min(maxBooksByVol, maxBooksByWeight);
        const totalBoxes = Math.ceil(qty / countPerBox);
        const totalShipCost = totalBoxes * BOX_PRICE;

        return { cost: totalShipCost, boxes: totalBoxes, boxName: box.name };
    }

    function calculate() {
        const size = document.getElementById('ind-size').value;
        const qty = parseInt(document.getElementById('ind-qty').value) || 0;
        const margin = parseInt(document.getElementById('ind-margin').value) || 0;
        
        const inType = document.getElementById('ind-innerType').value;
        const inGram = parseInt(document.getElementById('ind-innerGram').value) || 0;
        const inPrice = getPaperPrice(inType, inGram, size);
        const inDetail = document.getElementById('ind-innerDetail').value; 
        const inColorVal = inDetail.includes('color') ? 'color' : 'mono';

        let totalRaw = 0;
        let perUnitText = "ê¶Œë‹¹";

        if (currentMode.startsWith('flyer')) {
            perUnitText = "ì¥ë‹¹";
            const flyerSide = document.getElementById('ind-flyerSide').value;
            const isDouble = (flyerSide === 'double');
            
            let yieldSmall=0, yieldLarge=0;
            if(size==='A4') { yieldSmall=2; yieldLarge=8; } 
            else if(size==='A5') { yieldSmall=4; yieldLarge=16; }
            else if(size==='B5') { yieldSmall=2; yieldLarge=8; } 

            let pPaper=0, pPrint=0, pPlate=0;
            let msg = "";

            if (currentMode === 'flyer_small') {
                const sheetsA3 = Math.ceil(qty / yieldSmall);
                const priceA3 = inPrice / 2000; 
                pPaper = Math.round(sheetsA3 * priceA3);
                const clickUnit = INDIGO_CLICK[inColorVal];
                const finalClick = isDouble ? clickUnit : (clickUnit/2);
                pPrint = sheetsA3 * finalClick;
                msg = `ì†Œìš” A3: ${sheetsA3}ì¥`;
            } else { 
                const plateUnit = 11000; 
                const plates = (inColorVal==='color'?4:1) * (isDouble?2:1);
                pPlate = plates * plateUnit;
                const sheetsFull = Math.ceil(qty / yieldLarge) + 100; 
                const yeon = sheetsFull / 500;
                pPaper = Math.round(yeon * inPrice);
                const degrees = (inColorVal==='color'?4:1) * (isDouble?2:1);
                const printYeon = Math.max(1, yeon);
                pPrint = Math.round(printYeon * degrees * OFFSET_PRICE_PER_COLOR);
                msg = `ì†Œìš” ì—°ìˆ˜: ${yeon.toFixed(2)}ì—°`;
            }

            const ship = calculateShipping(qty, size, 0, 0, inGram, true);
            document.getElementById('shipCost').innerText = comma(ship.cost);
            // ë°•ìŠ¤ ì¢…ë¥˜ í‘œì‹œ
            document.getElementById('shipMsg').innerText = `${ship.boxName} ${ship.boxes}ê°œ`;

            document.getElementById('inPaper').innerText = comma(pPaper);
            document.getElementById('inPrint').innerText = comma(pPrint);
            document.getElementById('inPlate').innerText = comma(pPlate);
            document.getElementById('inTotal').innerText = comma(pPaper+pPrint+pPlate);
            document.getElementById('inMsg').innerText = msg;
            
            totalRaw = pPaper + pPrint + pPlate + ship.cost;

        } else {
            calculateBook(qty, size, margin, inPrice);
            return;
        }
        finalize(totalRaw, qty, margin, perUnitText);
    }

    function calculateBook(qty, size, margin, inPrice) {
        const innerPages = parseInt(document.getElementById('ind-innerPages').value) || 0;
        
        const cvTypeVal = document.getElementById('ind-coverType').value;
        const cvGram = parseInt(document.getElementById('ind-coverGram').value) || 0;
        const cvPrice = getPaperPrice(cvTypeVal, cvGram, size);
        
        const cvDetail = document.getElementById('ind-coverDetail').value; 
        const coating = document.getElementById('ind-coating').value;
        const cvColor = cvDetail.includes('color') ? 'color' : 'mono';
        const cvSide = cvDetail.includes('double') ? 'double' : 'single';
        const inSide = document.getElementById('ind-innerDetail').value.includes('double') ? 'double' : 'single';
        const inColorVal = document.getElementById('ind-innerDetail').value.includes('color') ? 'color' : 'mono';
        const bindType = document.getElementById('ind-bindType').value;

        const inGram = parseInt(document.getElementById('ind-innerGram').value) || 80;
        const ship = calculateShipping(qty, size, innerPages, cvGram, inGram, false);
        document.getElementById('shipCost').innerText = comma(ship.cost);
        // ë°•ìŠ¤ ì¢…ë¥˜ í‘œì‹œ
        document.getElementById('shipMsg').innerText = `${ship.boxName} ${ship.boxes}ê°œ`;

        let cvP=0, cvPr=0, cvPl=0, cvC=0; 
        let inP=0, inPr=0, inPl=0;
        let bind=0;
        let inMsg="", bindMsg="";

        if (currentMode === 'book_offset') {
            const plateUnit = 11000; 
            
            if(coating!=='none') {
                if(qty <= 500) cvC = 45000;
                else if(qty <= 1000) cvC = 80000;
                else if(qty <= 1500) cvC = 120000;
                else if(qty <= 2000) cvC = 155000;
                else cvC = 155000 + (Math.ceil((qty-2000)/500) * 35000); 
            }

            let itemsPerSheet = (size === 'A5') ? 4 : 2; 
            let netSheets2Jeol = Math.ceil(qty / itemsPerSheet); 
            let totalSheets2Jeol = netSheets2Jeol + 130; 
            
            let cvYeon = totalSheets2Jeol / 1000; 
            cvP = Math.round(cvYeon * cvPrice);

            const cvPlateCount = (cvSide==='double') ? 8 : 4; 
            cvPl = cvPlateCount * 8000; 

            const printDegrees = (cvSide==='double') ? 8 : 4; 
            const cvPrintYeon = Math.max(1, cvYeon);
            cvPr = Math.round(cvPrintYeon * printDegrees * OFFSET_PRICE_PER_COLOR);
            

            let pagesPerForm = (size === 'A5') ? 32 : 16; 

            const daesu = Math.ceil((innerPages/pagesPerForm)*2)/2;
            inMsg = `${innerPages}p / ${daesu}ëŒ€`;
            
            const inSheetsTotal = (daesu * qty) + (daesu * 130);
            const yeon = inSheetsTotal / 500;
            
            const plateCountPerDaesu = (inColorVal==='color'?4:1) * (inSide==='double'?2:1);
            inPl = Math.ceil(daesu * plateCountPerDaesu) * plateUnit;
            inP = Math.round(yeon * inPrice);
            inPr = Math.round(Math.max(1, yeon) * plateCountPerDaesu * OFFSET_PRICE_PER_COLOR);

            if (bindType === 'perfect') {
                const div = (size === 'A4') ? 4000 : 8000;
                const bindR = Math.ceil((innerPages / 2 * qty) / div);
                if (bindR <= 6) bind = 120000;
                else bind = 120000 + ((bindR - 6) * 20000);
                bindMsg = `ì œë³¸ì—°ìˆ˜: ${bindR}ì—°`;
            } else {
                bind = 50000 + (qty * 300);
            }

        } else {
            const cvSheet = cvPrice/2000; 
            cvP = Math.round(qty*cvSheet);
            const cClick = (currentMode==='book_digital'||cvColor==='color')?INDIGO_CLICK.color : INDIGO_CLICK.mono;
            const finalClick = (cvSide === 'double') ? cClick : (cClick/2); 
            cvPr = qty * finalClick;
            if(coating!=='none') cvC = qty*300;

            const inSheet = inPrice/2000;
            let factor = (size==='A5')?8:4; 
            if(inSide === 'single') factor = factor / 2; 
            const sheets = Math.ceil(innerPages/factor)*qty;
            inP = Math.round(sheets*inSheet);
            let iClick = (currentMode==='book_digital')?DIGITAL_CLICK : INDIGO_CLICK[inColorVal];
            if(inSide === 'single') iClick = iClick / 2; 
            inPr = sheets * iClick;
            bind = qty*(bindType==='staple'?200:400);
            inMsg = `ì†Œìš”ì¥ìˆ˜: ${sheets}ì¥`;
        }

        document.getElementById('cvPaper').innerText = comma(cvP);
        document.getElementById('cvPrint').innerText = comma(cvPr);
        document.getElementById('cvPlate').innerText = comma(cvPl);
        document.getElementById('cvCoat').innerText = comma(cvC);
        document.getElementById('cvTotal').innerText = comma(cvP+cvPr+cvPl+cvC);

        document.getElementById('inPaper').innerText = comma(inP);
        document.getElementById('inPrint').innerText = comma(inPr);
        document.getElementById('inPlate').innerText = comma(inPl);
        document.getElementById('inTotal').innerText = comma(inP+inPr+inPl);
        document.getElementById('inMsg').innerText = inMsg;
        document.getElementById('bindCost').innerText = comma(bind);
        document.getElementById('bindMsg').innerText = bindMsg;

        finalize((cvP+cvPr+cvPl+cvC + inP+inPr+inPl + bind + ship.cost), qty, margin, "ê¶Œë‹¹");
    }

    function finalize(total, qty, margin, unitText) {
        const totalMargin = total * (1 + margin/100);
        const vat = totalMargin * 0.1;
        const final = Math.floor((totalMargin+vat)/10)*10;
        const perUnit = Math.round(final/qty);

        document.getElementById('supplyPrice').innerText = comma(Math.round(totalMargin));
        document.getElementById('finalPrice').innerText = comma(final) + "ì›";
        document.getElementById('perBook').innerText = unitText + " " + comma(perUnit) + "ì›";
    }

    window.onload = function() { 
        initPaper(); 
        setMode('book_indigo', document.querySelector('.tab-btn.active')); 
    }
</script>

</body>
</html>